#! /usr/bin/env bash
# makes prompt

# function for adding virtualenv info to prompt
add_venv () {
	if [[ ! -z ${VIRTUAL_ENV} ]]; then
		echo $1$(basename ${VIRTUAL_ENV})$2
	fi
}
export -f add_venv

# function for setting non-bold 256 colors (fg & bg)
sc () { echo -ne "\[\e[0;38;5;$1;48;5;$2m\]$3\[\e[m\]"; }
# function for setting bold 256 colors (fg & bg)
scb () { echo -ne "\[\e[1;38;5;$1;48;5;$2m\]$3\[\e[m\]"; }
export -f sc scb
# Usage: $(sc FG_COLOR BG_COLOR STRING)
# Colors should be numbers 1-256.
# May want to single quote STRING.

# Escape and end sequences
ESC="\[\e["
END="\[\e[m\]"
export ESC END

# Standard titlebar
_theme_titlebar="\[\e]2;\u@\h \w\a\]"
export _theme_titlebar

# Colors
BLUE="${ESC}0;34m\]";
L_BLUE="${ESC}1;34m\]";
GREEN="${ESC}0;32m\]";
L_GREEN="${ESC}1;32m\]";
CYAN="${ESC}0;36m\]";
L_CYAN="${ESC}1;36m\]";
RED="${ESC}0;31m\]";
L_RED="${ESC}1;31m\]";
PURPLE="${ESC}0;35m\]";
L_PURPLE="${ESC}1;35m\]";
GRAY="${ESC}1;30m\]";
L_GRAY="${ESC}0;37m\]";
YELLOW="${ESC}1;33m\]";
WHITE="${ESC}1;37m\]";
BROWN="${ESC}0;33m\]";
BLACK="${ESC}0;30m\]";

#--BLUE STEEL THEME------------------------------------------------

#parts
ltcorner="\xE2\x94\x8C";
brcorner="\xE2\x94\x94";
line="\xE2\x94\x80";
line2="${line}${line}";
lbrack="\xE2\x9F\xAA";
rbrack="\xE2\x9F\xAB";

#lines and corners
part1="${WHITE}${ltcorner}${line}${L_BLUE}${line2}${BLUE}${line2}${CYAN}${line2}${END}";
after_name="${CYAN}${line2}${BLUE}${line2}${L_BLUE}${line2}${WHITE}${line2}${L_BLUE}${line2}${END}";
#after_name="${CYAN}${line2}${line}${BLUE}${line2}${L_BLUE}${line2}${WHITE}${line2}${line}${L_BLUE}${line2}${END}";
#after_name2="${CYAN}${line2}${line}${BLUE}${line2}${L_BLUE}${line2}${WHITE}${line2}${END}";
#after_name3="${CYAN}${line2}${BLUE}${line2}${L_BLUE}${line2}${WHITE}${line2}${END}";


#name
name="${BLUE}\u${END}${L_BLUE}@${END}${BLUE}\h${END}";
lbracket="${L_BLUE}${lbrack}${END}";
rbracket="${L_BLUE}${rbrack}${END}";
nameblock="${lbracket}${name}${rbracket}";

#time
#time='\\@';
time=$(date +'%I:%M:%S %p')
time='\\t';
timeblock="${L_BLUE}[${END}${BLUE}${time}${END}${L_BLUE}]${END}";

#titlebar
titlebar="\[\e]2;\u@\h \w\a\]";

#THEME FINAL STUFF
_blue_steel_output1="${titlebar}${part1}${nameblock}${after_name}${timeblock}${after_name}${L_BLUE}[${END}${BLUE}";
_blue_steel_output2="${END}${L_BLUE}]${END}${after_name}";
_blue_steel_endline="${L_BLUE}${line}${END}";
_blue_steel_last="${L_BLUE}${brcorner}${line}${BLUE}${line2}${CYAN}${line2}${L_BLUE}>${END} ";

# THEME FUNCTION
function _theme_blue_steel () {
	TEMP=$(ps aux | awk 'NR > 0 { s += $3 }; END {printf("%3.1f%%",s)}')
	TEMP_LEN=${#TEMP}
	ncols=$(echo -ne $COLUMNS)
	n=$((${ncols}-${TEMP_LEN}-72))

	var_lines=""
#	if [[ ${n} -eq -30 ]]; then
#		_blue_steel_output2="${END}${L_BLUE}]${END}${after_name2}";
#	elif [[ ${n} -eq -40 ]]; then
#		_blue_steel_output2="${END}${L_BLUE}]${END}${after_name3}";
#	else
#		for (( c=1; c<=n; c++ )); do
#			var_lines=${var_lines}"${_blue_steel_endline}";
#		done
#	fi
	for (( c=1; c<=n; c++ )); do
		var_lines=${var_lines}"${_blue_steel_endline}";
	done

	echo -ne "${_blue_steel_output1}${TEMP}${_blue_steel_output2}${var_lines}"
	echo -ne "\n${_blue_steel_last}";
}
export -f _theme_blue_steel
#----END OF BLUE STEEL-----------------------------------------------------

#----THEME X---------------------------------------------------------------
function _theme_theme_x () {
	# Colors.
	GRAY="${ESC}1;30m\]"
	WHITE="${ESC}1;37m\]"
	PURPLE="${ESC}0;35m\]"

	# Setup.
	_theme_x_name="${GRAY}[${END}${WHITE}\u${END}${PURPLE}@${END}${WHITE}\h${END}${GRAY}]${END}"
	_theme_x_output1="${_theme_x_titlebar}${_theme_x_name}"
	_theme_x_last="\\$ "

	echo -ne "${_theme_titlebar}$(add_venv '(' ')')${_theme_x_name}${_theme_x_last}"
}
export -f _theme_theme_x
#----END OF THEME X--------------------------------------------------------

#----DISTINGUISHED THEME --------------------------------------------------
# requires xterm-256color
# special colors
function _theme_distinguished() {
	_dist_bg=234
	_dist_name=$(scb 229 ${_dist_bg} '\u')
	_dist_at=$(scb 256 ${_dist_bg} '@')
	_dist_host=$(scb 67 ${_dist_bg} '\h')
	_dist_col=$(scb 256 ${_dist_bg} ':')
	_dist_lb=$(scb 242 ${_dist_bg} '[')
	_dist_rb=$(scb 242 ${_dist_bg} ']')
	_dist_path=${_dist_lb}$(scb 166 ${_dist_bg} '\w')${_dist_rb}
	_dist_end=$(scb 36 ${_dist_bg} '$')

	echo -ne "${_theme_titlebar}$(add_venv '[' ']')"
	echo -ne "${_dist_name}${_dist_at}${_dist_host}"
	echo -ne "${_dist_col}${_dist_path}${_dist_end} "
}
export -f _theme_distinguished
#----END OF DISTINGUISHED THEME--------------------------------------------

#----RANDOM COLOR THEME ---------------------------------------------------
function _theme_random_color() {
	color=$(($RANDOM % 7 + 31)) # set 31 to 30 for dark on light
	color256=$(($RANDOM % 239 + 17)) # 17-255 (no black since bg is black)
	echo -ne ${_theme_titlebar}$(add_venv '(' ')')$(scb 1 16 '\u@\h:[\w]$')" "
	# Note: set 1 to 0 for dark on light}
}
export -f _theme_random_color
#----END OF RANDOM COLOR --------------------------------------------------

#----RANDOM COLOR XTREME THEME --------------------------------------------
function _theme_random_color_xtreme() {

	# Random colors
	#col_range="7 + 31"
	col_range="239 + 17"
	color1=$(($RANDOM % ${col_range})) 
	color2=$(($RANDOM % ${col_range})) 
	color3=$(($RANDOM % ${col_range})) 
	color4=$(($RANDOM % ${col_range})) 
	color5=$(($RANDOM % ${col_range})) 
	color6=$(($RANDOM % ${col_range})) 
	color7=$(($RANDOM % ${col_range})) 
	color8=$(($RANDOM % ${col_range})) 
	# 17-255 (no black since bg is black)
	
	# Background color
	rcx_bg=16

	# Output
	echo -ne "${_theme_titlebar}$(add_venv '(' ')')"
	echo -ne "$(scb ${color1} ${rcx_bg} '\u')$(scb ${color2} ${rcx_bg} '@')"
	echo -ne "$(scb ${color3} ${rcx_bg} '\h')$(scb ${color4} ${rcx_bg} ':')"
	echo -ne "$(scb ${color5} ${rcx_bg} '[')$(scb ${color6} ${rcx_bg} '\w')"
	echo -ne "$(scb ${color7} ${rcx_bg} ']')$(scb ${color8} ${rcx_bg} '$') "
}
export -f _theme_random_color_xtreme
#----END OF RANDOM COLOR XTREME -------------------------------------------

# End of script
